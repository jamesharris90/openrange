import{c as L,u as me,j as e,M as xe,T as pe,a as oe,R as ve,r as m,C as fe,b as je,d as ge,D as be,S as qe,X,A as Ne,e as ke,B as J,f as ye,g as Me}from"./index-BbYXFDaV.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=L("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=L("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=L("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=L("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=L("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=L("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=L("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=L("MessageSquareWarning",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v2",key:"stiyo7"}],["path",{d:"M12 13h.01",key:"y0uutt"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=L("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=L("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=L("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=L("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=L("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Re=300*1e3;function Oe(){const{data:s,loading:l,error:n,refetch:c}=me("/api/ai-quant/market-context",[],{pollMs:Re,pauseWhenHidden:!0});return{data:s,loading:l,error:n,refresh:c}}const ie={bullish:{icon:oe,color:"var(--accent-green)",label:"BULLISH",bg:"rgba(34,197,94,0.10)"},bearish:{icon:pe,color:"var(--accent-red)",label:"BEARISH",bg:"rgba(239,68,68,0.10)"},neutral:{icon:xe,color:"var(--accent-orange)",label:"NEUTRAL",bg:"rgba(234,179,8,0.10)"}};function ze(){const[s,l]=m.useState([]),[n,c]=m.useState(!0),[t,o]=m.useState(!1),u=m.useCallback(async()=>{try{const d=await fetch("/api/ai-quant/sector-performance");if(!d.ok)throw new Error(`HTTP ${d.status}`);const h=await d.json();l(h.sectors||[])}catch{l([])}finally{c(!1)}},[]);if(m.useEffect(()=>{u()},[u]),n)return e.jsx("div",{className:"aiq-section-label",style:{opacity:.5},children:"Loading sectorsâ€¦"});if(!s.length)return null;const i=t?s:s.slice(0,6);return e.jsxs("div",{className:"aiq-sectors",children:[e.jsx("div",{className:"aiq-section-label",children:"Sector Performance"}),i.map(d=>e.jsxs("div",{className:"aiq-sector-row",children:[e.jsx("span",{className:"aiq-sector-row__name",children:d.sector}),e.jsx("span",{className:"aiq-sector-row__etf",children:d.etf}),e.jsxs("span",{className:`aiq-sector-row__change ${d.changePercent>=0?"positive":"negative"}`,children:[d.changePercent>=0?"+":"",d.changePercent.toFixed(2),"%"]}),e.jsx("div",{className:"aiq-sector-bar-wrap",children:e.jsx("div",{className:`aiq-sector-bar ${d.changePercent>=0?"aiq-sector-bar--up":"aiq-sector-bar--down"}`,style:{width:`${Math.min(100,Math.abs(d.changePercent)*20)}%`}})})]},d.etf)),s.length>6&&e.jsx("button",{className:"aiq-sectors-toggle",onClick:()=>o(!t),children:t?e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:12})," Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{size:12})," All ",s.length," sectors"]})})]})}function Be(){const{data:s,loading:l,error:n,refresh:c}=Oe();if(l)return e.jsx("div",{className:"aiq-panel aiq-market",children:e.jsx("div",{className:"aiq-panel__loading",children:"Loading market contextâ€¦"})});if(n)return e.jsx("div",{className:"aiq-panel aiq-market",children:e.jsxs("div",{className:"aiq-panel__error",children:["Error: ",n]})});if(!s)return null;const{indices:t,bias:o,biasReasons:u,technicals:i}=s,d=ie[o]||ie.neutral,h=d.icon;return e.jsxs("div",{className:"aiq-panel aiq-market",children:[e.jsxs("div",{className:"aiq-panel__header",children:[e.jsx("h3",{children:"Market Context"}),e.jsx("button",{className:"aiq-icon-btn",onClick:c,title:"Refresh",children:e.jsx(ve,{size:14})})]}),e.jsxs("div",{className:"aiq-bias-badge",style:{background:d.bg,borderColor:d.color},children:[e.jsx(h,{size:18,color:d.color}),e.jsx("span",{style:{color:d.color,fontWeight:700},children:d.label})]}),(u==null?void 0:u.length)>0&&e.jsx("ul",{className:"aiq-bias-reasons",children:u.map((r,p)=>e.jsx("li",{children:r},p))}),e.jsx("div",{className:"aiq-indices",children:(t||[]).map(r=>{var x,j;if(r.error)return e.jsxs("div",{className:"aiq-index-row aiq-index-row--error",children:[r.ticker,": unavailable"]},r.ticker);const p=r.changePercent>=0;return e.jsxs("div",{className:"aiq-index-row",children:[e.jsx("span",{className:"aiq-index-row__ticker",children:r.ticker.replace("^","")}),e.jsx("span",{className:"aiq-index-row__price",children:(x=r.price)==null?void 0:x.toFixed(2)}),e.jsxs("span",{className:`aiq-index-row__change ${p?"positive":"negative"}`,children:[p?"+":"",(j=r.changePercent)==null?void 0:j.toFixed(2),"%"]})]},r.ticker)})}),i&&Object.keys(i).length>0&&e.jsxs("div",{className:"aiq-technicals",children:[e.jsx("div",{className:"aiq-section-label",children:"Technicals"}),Object.entries(i).map(([r,p])=>e.jsxs("div",{className:"aiq-tech-row",children:[e.jsx("span",{className:"aiq-tech-row__sym",children:r}),e.jsxs("div",{className:"aiq-tech-row__mas",children:[e.jsx("span",{className:p.aboveSMA9?"positive":"negative",children:"9"}),e.jsx("span",{className:p.aboveSMA20?"positive":"negative",children:"20"}),e.jsx("span",{className:p.aboveSMA50?"positive":"negative",children:"50"})]})]},r)),e.jsxs("div",{className:"aiq-tech-legend",children:[e.jsx("span",{className:"positive",children:"â—"})," Above SMA",e.jsx("span",{className:"negative",style:{marginLeft:8},children:"â—"})," Below SMA"]})]}),e.jsx(ze,{})]})}const He={"Relative Volume":"Rel Volume","Average True Range":"ATR","Relative Strength Index (14)":"RSI","Average Volume":"Avg Volume","20-Day Simple Moving Average":"SMA20","50-Day Simple Moving Average":"SMA50","200-Day Simple Moving Average":"SMA200","52-Week High":"52W High","52-Week Low":"52W Low","Shares Float":"Float","Shares Outstanding":"Shares Out","Change from Open":"Change Open","Volatility (Week)":"Volatility W","Volatility (Month)":"Volatility M","Insider Ownership":"Insider Own","Institutional Ownership":"Inst Own","Short Ratio":"Short Ratio","Earnings Date":"Earnings","Analyst Recom":"Recom","Target Price":"Target Price","Performance (Week)":"Perf Week","Performance (Month)":"Perf Month","Performance (Quarter)":"Perf Quarter","Performance (Half Year)":"Perf Half Y","Performance (Year)":"Perf Year","Performance (YTD)":"Perf YTD"};function ue(s){if(!s)return s;const l={...s};for(const[n,c]of Object.entries(He))s[n]!==void 0&&l[c]===void 0&&(l[c]=s[n]);return l}function D(s){if(!s)return null;const l=String(s).replace(/,/g,"").trim(),n=parseFloat(l);return isNaN(n)?null:l.endsWith("B")?n*1e9:l.endsWith("M")?n*1e6:l.endsWith("K")?n*1e3:n}function V(s){if(s==null||s===""||s==="-")return null;const l=parseFloat(String(s).replace("%",""));return isNaN(l)?null:l}function ee(s){return s==null?"â€”":s>=1e9?`${(s/1e9).toFixed(1)}B`:s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}K`:String(s)}function U(s,l=2){return s!=null?`${s>=0?"+":""}${Number(s).toFixed(l)}%`:"â€”"}function se(s){if(!s.length)return"Low";const n=s.filter(c=>c!=null&&c!==""&&c!==0).length/s.length;return n>=.85?"High":n>=.5?"Medium":"Low"}function We(s){const l=[];let n=0;const c=V(s.Gap||s.Change),t=c!=null?Math.abs(c):0,o=parseFloat(s["Rel Volume"])||0,u=parseFloat(s.ATR)||0,i=parseFloat(s.Price)||0,d=D(s["Avg Volume"]),h=parseFloat(s.RSI)||50;let r=0;t>=8?r=30:t>=5?r=24:t>=3?r=18:t>=1&&(r=10),n+=r,l.push({factor:"Gap%",value:c!=null?`${t.toFixed(1)}%`:"â€”",pts:r,max:30,rule:"â‰¥8â†’30 â‰¥5â†’24 â‰¥3â†’18 â‰¥1â†’10"}),r=0,o>=5?r=30:o>=3?r=24:o>=2?r=18:o>=1.5?r=12:o>=1&&(r=6),n+=r,l.push({factor:"RVOL",value:o.toFixed(2),pts:r,max:30,rule:"â‰¥5â†’30 â‰¥3â†’24 â‰¥2â†’18 â‰¥1.5â†’12"});const p=i>0?u/i*100:0;r=0,p>=4?r=15:p>=3?r=12:p>=2?r=8:p>=1&&(r=4),n+=r,l.push({factor:"ATR/Price",value:`${p.toFixed(1)}%`,pts:r,max:15,rule:"â‰¥4%â†’15 â‰¥3%â†’12 â‰¥2%â†’8"}),r=0,d>=5e6?r=15:d>=2e6?r=12:d>=1e6?r=8:d>=5e5&&(r=5),n+=r,l.push({factor:"Avg Vol",value:ee(d),pts:r,max:15,rule:"â‰¥5Mâ†’15 â‰¥2Mâ†’12 â‰¥1Mâ†’8"}),r=0,h>70||h<30?r=10:h>65||h<35?r=6:r=3,n+=r,l.push({factor:"RSI",value:h.toFixed(0),pts:r,max:10,rule:">70 or <30 â†’ 10"});const x=Math.min(100,n),j=se([c,o||null,u||null,i||null,d,h!==50?h:null]);return{score:x,breakdown:l,dataQuality:j}}function Te(s){const l=[];let n=0;const c=parseFloat(s.expectedMovePercent)||0;let t=0;c>=10?t=25:c>=7?t=20:c>=5?t=15:c>=3&&(t=8),n+=t,l.push({factor:"Exp Move%",value:c?`Â±${c.toFixed(1)}%`:"â€”",pts:t,max:25,rule:"â‰¥10â†’25 â‰¥7â†’20 â‰¥5â†’15"});const o=parseInt(s.beatsInLast4)||0;t=Math.min(25,o*7),n+=t,l.push({factor:"Beats/4",value:`${o}/4`,pts:t,max:25,rule:"7 pts per beat"});const u=parseFloat(s.avgVolume)||0;t=0,u>=5e6?t=15:u>=2e6?t=12:u>=1e6?t=8:u>=5e5&&(t=5),n+=t,l.push({factor:"Avg Vol",value:ee(u||null),pts:t,max:15,rule:"â‰¥5Mâ†’15 â‰¥2Mâ†’12"});const i=Math.abs(parseFloat(s.surprise)||0);t=0,i>=20?t=20:i>=10?t=15:i>=5?t=10:i>=2&&(t=5),n+=t,l.push({factor:"Surprise",value:i?`${i.toFixed(1)}%`:"â€”",pts:t,max:20,rule:"â‰¥20â†’20 â‰¥10â†’15 â‰¥5â†’10"});const d=parseFloat(s.avgIV)||0;t=0,d>0&&d<.8?t=15:d>=.8&&d<1.2?t=10:d>=1.2&&(t=5),n+=t,l.push({factor:"IV",value:d?`${(d*100).toFixed(0)}%`:"â€”",pts:t,max:15,rule:"<80%â†’15 80-120%â†’10"});const h=Math.min(100,n),r=se([c||null,o||null,u||null,s.surprise,d||null]);return{score:h,breakdown:l,dataQuality:r}}function Ue(s){const l=[];let n=0;const c=V(s.SMA20),t=V(s.SMA50),o=V(s.SMA200),u=parseFloat(s.RSI)||50,i=parseFloat(s["Rel Volume"])||0,d=V(s["52W High"]),h=V(s.Change);let r=0;if(c!=null&&c>0&&(r+=3),t!=null&&t>0&&(r+=3),o!=null&&o>0&&(r+=9),n+=r,l.push({factor:"MA Align",value:`20:${c!=null?c>0?"âœ“":"âœ—":"â€”"} 50:${t!=null?t>0?"âœ“":"âœ—":"â€”"} 200:${o!=null?o>0?"âœ“":"âœ—":"â€”"}`,pts:r,max:15,rule:"200-SMA most weighted (9pts)"}),r=0,c!=null&&(c>=5?r=15:c>=3?r=10:c>=1&&(r=5)),n+=r,l.push({factor:"Trend Str",value:c!=null?`+${c.toFixed(1)}% above 20-SMA`:"â€”",pts:r,max:15,rule:"â‰¥5%â†’15 â‰¥3%â†’10 â‰¥1%â†’5"}),r=0,u>=55&&u<=65?r=15:u>=50&&u<=70?r=10:u>=45&&u<=75&&(r=5),n+=r,l.push({factor:"RSI",value:u.toFixed(0),pts:r,max:15,rule:"55-65â†’15 50-70â†’10"}),r=0,i>=3?r=25:i>=2?r=20:i>=1.5?r=14:i>=1.2?r=8:i>=1&&(r=3),n+=r,l.push({factor:"RVOL",value:i.toFixed(2),pts:r,max:25,rule:"â‰¥3â†’25 â‰¥2â†’20 â‰¥1.5â†’14"}),r=0,d!=null){const j=Math.abs(d);j<=3?r=20:j<=7?r=14:j<=15&&(r=7)}n+=r,l.push({factor:"52W High",value:d!=null?`${d.toFixed(1)}%`:"â€”",pts:r,max:20,rule:"â‰¤3%â†’20 â‰¤7%â†’14 â‰¤15%â†’7"}),r=0,h!=null&&h>3?r=10:h!=null&&h>1.5?r=7:h!=null&&h>0&&(r=3),n+=r,l.push({factor:"Change",value:h!=null?`${h.toFixed(1)}%`:"â€”",pts:r,max:10,rule:">3%â†’10 >1.5%â†’7 >0â†’3"});const p=Math.min(100,n),x=se([c,t,o,u!==50?u:null,i||null,d,h]);return{score:p,breakdown:l,dataQuality:x}}function R(s){return s>=75?"var(--accent-green)":s>=50?"var(--accent-blue)":s>=30?"var(--accent-orange)":"var(--accent-red)"}function le(s){return s>=75?"Strong":s>=50?"Moderate":s>=30?"Weak":"Poor"}function Qe(s){const l=[];if(!s)return l;const{earnings:n,expectedMove:c,company:t,technicals:o,sentiment:u}=s;if(n!=null&&n.earningsDate){const i=Math.ceil((new Date(n.earningsDate)-Date.now())/864e5);i>=0&&i<=2&&l.push({level:"high",text:`Earnings in ${i} day${i!==1?"s":""}`})}return c!=null&&c.avgIV&&c.avgIV>.8&&l.push({level:"medium",text:`IV elevated (${(c.avgIV*100).toFixed(0)}%)`}),t!=null&&t.floatShares&&t.floatShares<1e7&&l.push({level:"high",text:`Low float (${(t.floatShares/1e6).toFixed(1)}M)`}),t!=null&&t.shortPercentOfFloat&&t.shortPercentOfFloat>20?l.push({level:"high",text:`High short interest (${t.shortPercentOfFloat.toFixed(1)}%)`}):t!=null&&t.shortPercentOfFloat&&t.shortPercentOfFloat>10&&l.push({level:"medium",text:`Elevated short interest (${t.shortPercentOfFloat.toFixed(1)}%)`}),(o==null?void 0:o.distHigh52w)!=null&&Math.abs(o.distHigh52w)<3&&l.push({level:"medium",text:`Near 52W high (${o.distHigh52w.toFixed(1)}%)`}),(o==null?void 0:o.distSMA20)!=null&&o.distSMA20>10&&l.push({level:"medium",text:`Extended from 20-SMA (+${o.distSMA20.toFixed(1)}%)`}),o!=null&&o.rsi&&o.rsi>75?l.push({level:"high",text:`RSI overbought (${o.rsi})`}):o!=null&&o.rsi&&o.rsi<25&&l.push({level:"medium",text:`RSI oversold (${o.rsi})`}),(u==null?void 0:u.numberOfAnalysts)!=null&&u.numberOfAnalysts<3&&l.push({level:"low",text:"Low analyst coverage"}),t!=null&&t.avgVolume&&t.avgVolume<3e5&&l.push({level:"high",text:"Low average volume â€” liquidity risk"}),l}function De(s,l=0){const n=l>=2?10:l>=1?5:0,c=Math.min(100,s+n);return c>=85?{tier:"A+",color:"#22c55e",bg:"rgba(34,197,94,0.12)"}:c>=70?{tier:"A",color:"#3b82f6",bg:"rgba(59,130,246,0.12)"}:c>=50?{tier:"B",color:"#f59e0b",bg:"rgba(245,158,11,0.12)"}:{tier:"C",color:"#ef4444",bg:"rgba(239,68,68,0.10)"}}function Ke(s,l){const n=[];if(!s)return n;if(s.breakdown)for(const c of s.breakdown)c.pts>0?n.push(`${c.factor}: ${c.value} â†’ +${c.pts}/${c.max} pts (${c.rule})`):n.push(`${c.factor}: ${c.value} â†’ 0/${c.max} pts`);return s.confirmations>0&&n.push(`Cross-scanner: confirmed by ${s.confirmations} other scanner(s)`),s.confidenceTier&&n.push(`Confidence tier: ${s.confidenceTier.tier}`),n}function ae(s,l){return!l||Object.keys(l).length===0?s:s.filter(n=>!(l.priceMin&&(n.price==null||n.price<Number(l.priceMin))||l.priceMax&&(n.price==null||n.price>Number(l.priceMax))||l.gapMin&&(n.gap==null||Math.abs(n.gap)<Number(l.gapMin))||l.rvolMin&&(n.rvol==null||n.rvol<Number(l.rvolMin))||l.avgVolMin&&(n.avgVolume==null||n.avgVolume<Number(l.avgVolMin))||l.emMin&&(n.expectedMovePercent==null||n.expectedMovePercent<Number(l.emMin))||l.minConfirmations&&(n.confirmations==null||n.confirmations<Number(l.minConfirmations))||l.validationMode&&((n.confirmations||0)<1||n.dataQuality==="Low"||n.avgVolume!=null&&n.avgVolume<5e5)))}function Ge(s,l,n){if(!s.length)return;const c=["ticker","score","dataQuality","confirmations","price"];n==="orb"?c.push("gap","change","rvol","atr","rsi","avgVolume"):n==="earnings"?c.push("date","expectedMovePercent","beatsInLast4","surprise","avgIV"):c.push("change","sma20","sma50","sma200","rvol","rsi","dist52wh");const t=Math.max(...s.map(p=>{var x;return((x=p.breakdown)==null?void 0:x.length)||0}));for(let p=0;p<t;p++)c.push(`factor_${p+1}`,`pts_${p+1}`,`max_${p+1}`);const o=c.join(","),u=s.map(p=>c.map(j=>{var M,g,y,S,b,a;if(j.startsWith("factor_")){const v=parseInt(j.split("_")[1])-1;return((g=(M=p.breakdown)==null?void 0:M[v])==null?void 0:g.factor)||""}if(j.startsWith("pts_")){const v=parseInt(j.split("_")[1])-1;return((S=(y=p.breakdown)==null?void 0:y[v])==null?void 0:S.pts)??""}if(j.startsWith("max_")){const v=parseInt(j.split("_")[1])-1;return((a=(b=p.breakdown)==null?void 0:b[v])==null?void 0:a.max)??""}const k=p[j];return k!=null?String(k).replace(/,/g,""):""}).join(",")),i=[o,...u].join(`
`),d=new Blob([i],{type:"text/csv"}),h=URL.createObjectURL(d),r=document.createElement("a");r.href=h,r.download=l||"aiq-export.csv",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(h)}function K({breakdown:s,score:l}){const[n,c]=m.useState(!1);return s!=null&&s.length?e.jsxs("div",{className:"aiq-score-bd",children:[e.jsx("button",{className:"aiq-score-bd-toggle",onClick:t=>{t.stopPropagation(),c(!n)},title:"Click to see score breakdown",children:e.jsx("span",{className:"aiq-score-bd-arrow",children:n?"â–¾":"â–¸"})}),n&&e.jsxs("div",{className:"aiq-score-bd-popup",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"aiq-score-bd-header",children:[e.jsx("span",{children:"Factor"}),e.jsx("span",{children:"Pts"})]}),s.map((t,o)=>e.jsxs("div",{className:"aiq-score-bd-row",children:[e.jsx("span",{className:"aiq-score-bd-factor",children:t.factor}),e.jsx("span",{className:"aiq-score-bd-value",children:t.value}),e.jsx("div",{className:"aiq-score-bd-bar-wrap",children:e.jsx("div",{className:"aiq-score-bd-bar",style:{width:`${t.pts/t.max*100}%`,background:t.pts>=t.max*.7?"var(--accent-green)":t.pts>=t.max*.4?"var(--accent-blue)":"var(--accent-orange)"}})}),e.jsxs("span",{className:"aiq-score-bd-pts",children:[t.pts,"/",t.max]})]},o)),e.jsxs("div",{className:"aiq-score-bd-total",children:["Total: ",l,"/100"]})]})]}):null}function G({tier:s}){return s?e.jsx("span",{className:"aiq-tier-badge",style:{background:s.bg,color:s.color,borderColor:s.color},children:s.tier}):null}function Y({quality:s}){const l={high:{color:"var(--accent-green)",label:"High"},medium:{color:"var(--accent-orange)",label:"Med"},low:{color:"var(--accent-red)",label:"Low"}},n=l[s]||l.low;return e.jsx("span",{className:"aiq-dq-dot",title:`Data quality: ${n.label}`,style:{background:n.color}})}function Ye({onSelectTicker:s,filters:l,selected:n,onToggleSelect:c,onDataReady:t,watchlist:o}){const[u,i]=m.useState([]),[d,h]=m.useState(!0),[r,p]=m.useState(null),[x,j]=m.useState("score"),[k,M]=m.useState(!1);m.useEffect(()=>{let a=!1;return h(!0),fetch("/api/finviz/screener?f=sh_avgvol_o500,ta_change_u3&v=152&c=0,1,2,3,4,5,6,7,8,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70").then(v=>{if(!v.ok)throw new Error(`HTTP ${v.status}`);return v.json()}).then(v=>{if(a)return;const P=(v||[]).slice(0,100).map(C=>{const f=ue(C),A=We(f);return{...f,ticker:f.Ticker||"",price:parseFloat(f.Price)||null,change:V(f.Change),gap:V(f.Gap),rvol:parseFloat(f["Rel Volume"])||null,atr:parseFloat(f.ATR)||null,rsi:parseFloat(f.RSI)||null,avgVolume:D(f["Avg Volume"]),volume:D(f.Volume),score:A.score,breakdown:A.breakdown,dataQuality:A.dataQuality}});i(P),t==null||t("orb",P),p(null)}).catch(v=>{a||p(v.message)}).finally(()=>{a||h(!1)}),()=>{a=!0}},[t]);const g=m.useMemo(()=>ae(u,l),[u,l]),y=m.useMemo(()=>{const a=[...g];return a.sort((v,P)=>{const C=v[x]??-1/0,f=P[x]??-1/0;return k?C-f:f-C}),a},[g,x,k]),S=a=>{x===a?M(!k):(j(a),M(!1))},b=({k:a,label:v})=>e.jsxs("th",{onClick:()=>S(a),className:"aiq-th aiq-th--sortable",children:[v," ",x===a?k?"â–²":"â–¼":""]});return d?e.jsx("div",{className:"aiq-module-loading",children:"Scanning ORB candidatesâ€¦"}):r?e.jsxs("div",{className:"aiq-module-error",children:["Error: ",r]}):u.length?e.jsxs("div",{className:"aiq-module",children:[e.jsxs("div",{className:"aiq-module__bar",children:[e.jsx("span",{className:"aiq-module__universe",children:"ðŸ“¡ Universe: Finviz Gappers Â· Avg Vol > 500K Â· Change > 3%"}),e.jsxs("span",{className:"aiq-module__count",children:[y.length," / ",u.length]})]}),e.jsx("div",{className:"aiq-table-wrap",children:e.jsxs("table",{className:"aiq-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"aiq-th aiq-th--check",children:e.jsx("input",{type:"checkbox",onChange:a=>y.forEach(v=>c==null?void 0:c(v.ticker,a.target.checked))})}),e.jsx(b,{k:"score",label:"Score"}),e.jsx("th",{className:"aiq-th",children:"Ticker"}),e.jsx(b,{k:"price",label:"Price"}),e.jsx(b,{k:"gap",label:"Gap%"}),e.jsx(b,{k:"change",label:"Chg%"}),e.jsx(b,{k:"rvol",label:"RVOL"}),e.jsx(b,{k:"atr",label:"ATR"}),e.jsx(b,{k:"rsi",label:"RSI"}),e.jsx(b,{k:"avgVolume",label:"Avg Vol"})]})}),e.jsx("tbody",{children:y.map(a=>e.jsxs("tr",{className:`aiq-row ${n!=null&&n.has(a.ticker)?"aiq-row--selected":""}`,onClick:()=>s==null?void 0:s(a.ticker),children:[e.jsx("td",{className:"aiq-td--check",onClick:v=>v.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:(n==null?void 0:n.has(a.ticker))||!1,onChange:()=>c==null?void 0:c(a.ticker)})}),e.jsxs("td",{className:"aiq-td--score",children:[e.jsx("span",{className:"aiq-score-pill",style:{background:R(a.score)+"22",color:R(a.score),borderColor:R(a.score)},children:a.score}),e.jsx(G,{tier:a.confidenceTier}),e.jsx(Y,{quality:a.dataQuality}),e.jsx(K,{breakdown:a.breakdown,score:a.score})]}),e.jsxs("td",{className:"aiq-td--ticker",children:[(o==null?void 0:o.has(a.ticker))&&e.jsx("span",{className:"aiq-wl-dot",title:"In watchlist",children:"â˜…"}),a.ticker]}),e.jsx("td",{children:a.price!=null?`$${a.price.toFixed(2)}`:"â€”"}),e.jsx("td",{className:a.gap!=null?a.gap>=0?"positive":"negative":"",children:U(a.gap)}),e.jsx("td",{className:a.change!=null?a.change>=0?"positive":"negative":"",children:U(a.change)}),e.jsx("td",{style:{color:a.rvol!=null&&a.rvol>=2?"var(--accent-green)":void 0},children:a.rvol!=null?a.rvol.toFixed(2):"â€”"}),e.jsx("td",{children:a.atr!=null?a.atr.toFixed(2):"â€”"}),e.jsx("td",{style:{color:a.rsi!=null&&a.rsi>70?"var(--accent-red)":a.rsi!=null&&a.rsi<30?"var(--accent-green)":void 0},children:a.rsi!=null?a.rsi.toFixed(0):"â€”"}),e.jsx("td",{children:ee(a.avgVolume)})]},a.ticker))})]})})]}):e.jsx("div",{className:"aiq-module-empty",children:"No ORB candidates found. Markets may be closed."})}function we({onSelectTicker:s,filters:l,selected:n,onToggleSelect:c,onDataReady:t,watchlist:o}){const[u,i]=m.useState([]),[d,h]=m.useState(!0),[r,p]=m.useState(null),[x,j]=m.useState("score"),[k,M]=m.useState(!1);m.useEffect(()=>{let a=!1;h(!0);const v=new Date,P=v.toISOString().split("T")[0],C=new Date(v);C.setDate(C.getDate()+5);const f=C.toISOString().split("T")[0];return fetch(`/api/earnings/calendar?from=${P}&to=${f}`).then(A=>{if(!A.ok)throw new Error(`HTTP ${A.status}`);return A.json()}).then(async A=>{if(a)return;const I=(Array.isArray(A)?A:A.earnings||[]).filter(O=>O.symbol).slice(0,120),W=[];for(let O=0;O<I.length;O+=8){const F=I.slice(O,O+8),H=await Promise.allSettled(F.map(N=>fetch(`/api/yahoo/options?t=${N.symbol}`).then(E=>E.ok?E.json():null)));F.forEach((N,E)=>{var B;const _=((B=H[E])==null?void 0:B.status)==="fulfilled"?H[E].value:null;W.push({ticker:N.symbol,date:N.date||P,hour:N.hour||"",epsEstimate:N.epsEstimate??null,epsActual:N.epsActual??null,revenueEstimate:N.revenueEstimate??null,revenueActual:N.revenueActual??null,surprise:N.surprisePercent??null,beatsInLast4:N.beatsInLast4??null,expectedMovePercent:(_==null?void 0:_.expectedMovePercent)??null,expectedMove:(_==null?void 0:_.expectedMove)??null,avgIV:(_==null?void 0:_.avgIV)??null,avgVolume:N.avgVolume||(_==null?void 0:_.avgVolume)||null,price:(_==null?void 0:_.price)||N.price||null,marketCap:(_==null?void 0:_.marketCap)||N.marketCap||null})})}const T=W.map(O=>{const F=Te(O);return{...O,score:F.score,breakdown:F.breakdown,dataQuality:F.dataQuality}});i(T),t==null||t("earnings",T),p(null)}).catch(A=>{a||p(A.message)}).finally(()=>{a||h(!1)}),()=>{a=!0}},[t]);const g=m.useMemo(()=>ae(u,l),[u,l]),y=m.useMemo(()=>{const a=[...g];return a.sort((v,P)=>{const C=v[x]??-1/0,f=P[x]??-1/0;return k?C-f:f-C}),a},[g,x,k]),S=a=>{x===a?M(!k):(j(a),M(!1))},b=({k:a,label:v})=>e.jsxs("th",{onClick:()=>S(a),className:"aiq-th aiq-th--sortable",children:[v," ",x===a?k?"â–²":"â–¼":""]});return d?e.jsx("div",{className:"aiq-module-loading",children:"Scanning earnings candidatesâ€¦"}):r?e.jsxs("div",{className:"aiq-module-error",children:["Error: ",r]}):u.length?e.jsxs("div",{className:"aiq-module",children:[e.jsxs("div",{className:"aiq-module__bar",children:[e.jsx("span",{className:"aiq-module__universe",children:"ðŸ“… Universe: Earnings Calendar Â· Next 5 Days Â· Options-Enriched"}),e.jsxs("span",{className:"aiq-module__count",children:[y.length," / ",u.length]})]}),e.jsx("div",{className:"aiq-table-wrap",children:e.jsxs("table",{className:"aiq-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"aiq-th aiq-th--check",children:e.jsx("input",{type:"checkbox",onChange:a=>y.forEach(v=>c==null?void 0:c(v.ticker,a.target.checked))})}),e.jsx(b,{k:"score",label:"Score"}),e.jsx("th",{className:"aiq-th",children:"Ticker"}),e.jsx("th",{className:"aiq-th",children:"Date"}),e.jsx(b,{k:"expectedMovePercent",label:"Exp Move%"}),e.jsx(b,{k:"price",label:"Price"}),e.jsx("th",{className:"aiq-th",children:"EPS Est"}),e.jsx("th",{className:"aiq-th",children:"EPS Act"}),e.jsx(b,{k:"surprise",label:"Surprise%"}),e.jsx(b,{k:"beatsInLast4",label:"Beats/4"})]})}),e.jsx("tbody",{children:y.map(a=>e.jsxs("tr",{className:`aiq-row ${n!=null&&n.has(a.ticker)?"aiq-row--selected":""}`,onClick:()=>s==null?void 0:s(a.ticker),children:[e.jsx("td",{className:"aiq-td--check",onClick:v=>v.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:(n==null?void 0:n.has(a.ticker))||!1,onChange:()=>c==null?void 0:c(a.ticker)})}),e.jsxs("td",{className:"aiq-td--score",children:[e.jsx("span",{className:"aiq-score-pill",style:{background:R(a.score)+"22",color:R(a.score),borderColor:R(a.score)},children:a.score}),e.jsx(G,{tier:a.confidenceTier}),e.jsx(Y,{quality:a.dataQuality}),e.jsx(K,{breakdown:a.breakdown,score:a.score})]}),e.jsxs("td",{className:"aiq-td--ticker",children:[(o==null?void 0:o.has(a.ticker))&&e.jsx("span",{className:"aiq-wl-dot",title:"In watchlist",children:"â˜…"}),a.ticker]}),e.jsxs("td",{className:"aiq-td--date",children:[a.date," ",a.hour==="bmo"?"ðŸŒ…":a.hour==="amc"?"ðŸŒ™":""]}),e.jsx("td",{style:{color:a.expectedMovePercent!=null&&a.expectedMovePercent>5?"var(--accent-orange)":void 0},children:a.expectedMovePercent!=null?`Â±${a.expectedMovePercent.toFixed(1)}%`:"â€”"}),e.jsx("td",{children:a.price!=null?`$${a.price.toFixed(2)}`:"â€”"}),e.jsx("td",{children:a.epsEstimate!=null?a.epsEstimate.toFixed(2):"â€”"}),e.jsx("td",{className:a.epsActual!=null&&a.epsEstimate!=null?a.epsActual>=a.epsEstimate?"positive":"negative":"",children:a.epsActual!=null?a.epsActual.toFixed(2):"â€”"}),e.jsx("td",{className:a.surprise!=null?a.surprise>0?"positive":a.surprise<0?"negative":"":"",children:a.surprise!=null?`${a.surprise>0?"+":""}${a.surprise.toFixed(1)}%`:"â€”"}),e.jsx("td",{children:a.beatsInLast4!=null?`${a.beatsInLast4}/4`:"â€”"})]},a.ticker))})]})})]}):e.jsx("div",{className:"aiq-module-empty",children:"No upcoming earnings found."})}function Je({onSelectTicker:s,filters:l,selected:n,onToggleSelect:c,onDataReady:t,watchlist:o}){const[u,i]=m.useState([]),[d,h]=m.useState(!0),[r,p]=m.useState(null),[x,j]=m.useState("score"),[k,M]=m.useState(!1);m.useEffect(()=>{let a=!1;return h(!0),fetch("/api/finviz/screener?f=ta_sma20_pa,ta_sma50_pa,sh_avgvol_o500&v=152&c=0,1,2,3,4,5,6,7,8,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70&o=-relativevolume").then(v=>{if(!v.ok)throw new Error(`HTTP ${v.status}`);return v.json()}).then(v=>{if(a)return;const P=(v||[]).slice(0,100).map(C=>{const f=ue(C),A=Ue(f);return{...f,ticker:f.Ticker||"",price:parseFloat(f.Price)||null,change:V(f.Change),sma20:V(f.SMA20),sma50:V(f.SMA50),sma200:V(f.SMA200),rvol:parseFloat(f["Rel Volume"])||null,rsi:parseFloat(f.RSI)||null,dist52wh:V(f["52W High"]),dist52wl:V(f["52W Low"]),beta:parseFloat(f.Beta)||null,avgVolume:D(f["Avg Volume"]),score:A.score,breakdown:A.breakdown,dataQuality:A.dataQuality}});i(P),t==null||t("continuation",P),p(null)}).catch(v=>{a||p(v.message)}).finally(()=>{a||h(!1)}),()=>{a=!0}},[t]);const g=m.useMemo(()=>ae(u,l),[u,l]),y=m.useMemo(()=>{const a=[...g];return a.sort((v,P)=>{const C=v[x]??-1/0,f=P[x]??-1/0;return k?C-f:f-C}),a},[g,x,k]),S=a=>{x===a?M(!k):(j(a),M(!1))},b=({k:a,label:v})=>e.jsxs("th",{onClick:()=>S(a),className:"aiq-th aiq-th--sortable",children:[v," ",x===a?k?"â–²":"â–¼":""]});return d?e.jsx("div",{className:"aiq-module-loading",children:"Scanning continuation setupsâ€¦"}):r?e.jsxs("div",{className:"aiq-module-error",children:["Error: ",r]}):u.length?e.jsxs("div",{className:"aiq-module",children:[e.jsxs("div",{className:"aiq-module__bar",children:[e.jsx("span",{className:"aiq-module__universe",children:"ðŸ“ˆ Universe: Finviz Trend Â· Above 20 & 50 SMA Â· Avg Vol > 500K"}),e.jsxs("span",{className:"aiq-module__count",children:[y.length," / ",u.length]})]}),e.jsx("div",{className:"aiq-table-wrap",children:e.jsxs("table",{className:"aiq-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"aiq-th aiq-th--check",children:e.jsx("input",{type:"checkbox",onChange:a=>y.forEach(v=>c==null?void 0:c(v.ticker,a.target.checked))})}),e.jsx(b,{k:"score",label:"Score"}),e.jsx("th",{className:"aiq-th",children:"Ticker"}),e.jsx(b,{k:"price",label:"Price"}),e.jsx(b,{k:"change",label:"Chg%"}),e.jsx(b,{k:"sma20",label:"vs 20-SMA"}),e.jsx(b,{k:"sma50",label:"vs 50-SMA"}),e.jsx(b,{k:"rsi",label:"RSI"}),e.jsx(b,{k:"rvol",label:"RVOL"}),e.jsx(b,{k:"dist52wh",label:"vs 52W-H"})]})}),e.jsx("tbody",{children:y.map(a=>e.jsxs("tr",{className:`aiq-row ${n!=null&&n.has(a.ticker)?"aiq-row--selected":""}`,onClick:()=>s==null?void 0:s(a.ticker),children:[e.jsx("td",{className:"aiq-td--check",onClick:v=>v.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:(n==null?void 0:n.has(a.ticker))||!1,onChange:()=>c==null?void 0:c(a.ticker)})}),e.jsxs("td",{className:"aiq-td--score",children:[e.jsx("span",{className:"aiq-score-pill",style:{background:R(a.score)+"22",color:R(a.score),borderColor:R(a.score)},children:a.score}),e.jsx(G,{tier:a.confidenceTier}),e.jsx(Y,{quality:a.dataQuality}),e.jsx(K,{breakdown:a.breakdown,score:a.score})]}),e.jsxs("td",{className:"aiq-td--ticker",children:[(o==null?void 0:o.has(a.ticker))&&e.jsx("span",{className:"aiq-wl-dot",title:"In watchlist",children:"â˜…"}),a.ticker]}),e.jsx("td",{children:a.price!=null?`$${a.price.toFixed(2)}`:"â€”"}),e.jsx("td",{className:a.change!=null?a.change>=0?"positive":"negative":"",children:U(a.change)}),e.jsx("td",{className:a.sma20!=null&&a.sma20>0?"positive":"",children:U(a.sma20,1)}),e.jsx("td",{className:a.sma50!=null&&a.sma50>0?"positive":"",children:U(a.sma50,1)}),e.jsx("td",{style:{color:a.rsi!=null&&a.rsi>65?"var(--accent-orange)":void 0},children:a.rsi!=null?a.rsi.toFixed(0):"â€”"}),e.jsx("td",{style:{color:a.rvol!=null&&a.rvol>=1.5?"var(--accent-green)":void 0},children:a.rvol!=null?a.rvol.toFixed(2):"â€”"}),e.jsx("td",{children:a.dist52wh!=null?`${a.dist52wh.toFixed(1)}%`:"â€”"})]},a.ticker))})]})})]}):e.jsx("div",{className:"aiq-module-empty",children:"No continuation candidates found."})}const re=[{id:"orb",label:"ORB Intraday",icon:Le,desc:"Opening Range Breakout â€” gap + volume momentum"},{id:"earnings",label:"Earnings Momentum",icon:ge,desc:"Post-earnings moves â€” expected move + surprise"},{id:"continuation",label:"Continuation",icon:oe,desc:"Multi-day trend â€” MA alignment + breakout"}];function Ze({activeStrategy:s,onChangeStrategy:l,onSelectTicker:n,filters:c,selected:t,onToggleSelect:o,onDataReady:u,allData:i,addToast:d,watchlist:h}){var M;const[r,p]=m.useState(!1),x=(i==null?void 0:i[s])||[],j=g=>{let y;if(g==="selected"?y=x.filter(S=>t.has(S.ticker)):g==="top10"?y=[...x].sort((S,b)=>b.score-S.score).slice(0,10):y=x,!y.length){d==null||d("No rows to export","info");return}Ge(y,`aiq-${s}-${g}.csv`,s),d==null||d(`Exported ${y.length} rows`,"success"),p(!1)},k=()=>{if(!t.size){d==null||d("Select rows first","info");return}let g=0;for(const y of t)h!=null&&h.has(y)||(h==null||h.add(y,`aiq-${s}`),g++);d==null||d(`Added ${g} ticker${g!==1?"s":""} to watchlist`,"success")};return e.jsxs("div",{className:"aiq-panel aiq-strategy",children:[e.jsx("div",{className:"aiq-tabs",children:re.map(g=>{const y=g.icon,S=((i==null?void 0:i[g.id])||[]).length;return e.jsxs("button",{className:`aiq-tab ${s===g.id?"aiq-tab--active":""}`,onClick:()=>l(g.id),title:g.desc,children:[e.jsx(y,{size:15}),e.jsx("span",{children:g.label}),S>0&&e.jsx("span",{className:"aiq-tab-count",children:S})]},g.id)})}),e.jsxs("div",{className:"aiq-toolbar",children:[e.jsx("div",{className:"aiq-tab-desc",children:(M=re.find(g=>g.id===s))==null?void 0:M.desc}),e.jsxs("div",{className:"aiq-toolbar-actions",children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("button",{className:"aiq-btn aiq-btn--sm",onClick:()=>p(!r),children:[e.jsx(be,{size:13})," CSV"]}),r&&e.jsxs("div",{className:"aiq-export-menu",children:[e.jsx("button",{onClick:()=>j("all"),children:"Export All"}),e.jsx("button",{onClick:()=>j("top10"),children:"Export Top 10"}),e.jsx("button",{onClick:()=>j("selected"),children:"Export Selected"})]})]}),e.jsxs("button",{className:"aiq-btn aiq-btn--sm",onClick:k,disabled:!t.size,children:[e.jsx(Pe,{size:13})," Add to WL (",t.size,")"]})]})]}),e.jsxs("div",{className:"aiq-module-container",children:[s==="orb"&&e.jsx(Ye,{onSelectTicker:n,filters:c,selected:t,onToggleSelect:o,onDataReady:u,watchlist:h}),s==="earnings"&&e.jsx(we,{onSelectTicker:n,filters:c,selected:t,onToggleSelect:o,onDataReady:u,watchlist:h}),s==="continuation"&&e.jsx(Je,{onSelectTicker:n,filters:c,selected:t,onToggleSelect:o,onDataReady:u,watchlist:h})]})]})}const ce={high:{color:"var(--accent-red)",icon:Ie},medium:{color:"var(--accent-orange)",icon:Ee},low:{color:"var(--accent-blue)",icon:Ae}};function Xe({ticker:s,onClose:l,onBuildPlan:n,activeStrategy:c,rowData:t,watchlist:o,addToast:u}){var v,P,C,f,A;const[i,d]=m.useState(null),[h,r]=m.useState(!1),[p,x]=m.useState(null);if(m.useEffect(()=>{if(!s)return;let q=!1;return r(!0),x(null),fetch(`/api/earnings-research/${s}`).then(I=>{if(!I.ok)throw new Error(`HTTP ${I.status}`);return I.json()}).then(I=>{q||(d(I),x(null))}).catch(I=>{q||x(I.message)}).finally(()=>{q||r(!1)}),()=>{q=!0}},[s]),!s)return null;const j=i?Qe(i):[],k=t?Ke(t):[],M=o==null?void 0:o.has(s),g=()=>{o==null||o.add(s,`aiq-${c}`),u==null||u(`${s} added to watchlist`,"success")},y=()=>{o==null||o.remove(s),u==null||u(`${s} removed from watchlist`,"info")},S=q=>q!=null?`$${Number(q).toFixed(2)}`:"â€”",b=q=>q?q>=1e12?`$${(q/1e12).toFixed(1)}T`:q>=1e9?`$${(q/1e9).toFixed(1)}B`:q>=1e6?`$${(q/1e6).toFixed(0)}M`:`$${q}`:"â€”",a=q=>q?q>=1e9?`${(q/1e9).toFixed(1)}B`:q>=1e6?`${(q/1e6).toFixed(1)}M`:q>=1e3?`${(q/1e3).toFixed(0)}K`:String(q):"â€”";return e.jsxs("div",{className:"aiq-panel aiq-deep-dive",children:[e.jsxs("div",{className:"aiq-panel__header",children:[e.jsxs("h3",{children:[s," Deep Dive"]}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsxs("button",{className:"aiq-btn aiq-btn--sm",onClick:M?y:g,title:M?"Remove from watchlist":"Add to watchlist",children:[e.jsx(qe,{size:13,fill:M?"var(--accent-orange)":"none",color:M?"var(--accent-orange)":"currentColor"}),M?"In WL":"+ WL"]}),e.jsx("button",{className:"aiq-icon-btn",onClick:l,children:e.jsx(X,{size:16})})]})]}),h&&e.jsx("div",{className:"aiq-panel__loading",children:"Loading deep diveâ€¦"}),p&&e.jsxs("div",{className:"aiq-panel__error",children:["Error: ",p]}),i&&e.jsxs("div",{className:"aiq-dd-content",children:[e.jsxs("div",{className:"aiq-dd-price-header",children:[e.jsx("span",{className:"aiq-dd-price",children:S(i.price)}),e.jsx("span",{className:"aiq-dd-name",children:i.name}),t&&e.jsx(G,{tier:t.confidenceTier}),t&&e.jsx(Y,{quality:t.dataQuality})]}),t&&e.jsxs("div",{className:"aiq-dd-section aiq-dd-rank-why",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"ðŸ“Š Why Is This Ranked?"}),e.jsxs("div",{className:"aiq-dd-rank-score",children:[e.jsx(K,{breakdown:t.breakdown,score:t.score}),e.jsxs("span",{style:{color:R(t.score),fontWeight:600},children:["/100 ",le(t.score)]})]}),e.jsx("ul",{className:"aiq-rank-reasons",children:k.map((q,I)=>e.jsx("li",{children:q},I))}),((v=t.confirmBadges)==null?void 0:v.length)>0&&e.jsxs("div",{className:"aiq-rank-confirmations",children:["Also found in: ",t.confirmBadges.join(", ")]})]}),i.setupScore&&e.jsxs("div",{className:"aiq-dd-score-box",children:[e.jsx("div",{className:"aiq-dd-score-label",children:"Setup Score"}),e.jsxs("div",{className:"aiq-dd-score-value",style:{color:R(i.setupScore.score)},children:[i.setupScore.score,e.jsx("span",{className:"aiq-dd-score-tag",children:le(i.setupScore.score)})]}),e.jsx("div",{className:"aiq-dd-score-bar",children:e.jsx("div",{className:"aiq-dd-score-fill",style:{width:`${i.setupScore.score}%`,background:R(i.setupScore.score)}})})]}),j.length>0&&e.jsxs("div",{className:"aiq-dd-section",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"âš  Risk Flags"}),e.jsx("div",{className:"aiq-risk-flags",children:j.map((q,I)=>{const{color:W,icon:T}=ce[q.level]||ce.low;return e.jsxs("div",{className:"aiq-risk-flag",style:{borderLeftColor:W},children:[e.jsx(T,{size:14,color:W}),e.jsx("span",{children:q.text})]},I)})})]}),i.company&&e.jsxs("div",{className:"aiq-dd-section",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"Company"}),e.jsxs("div",{className:"aiq-dd-grid",children:[e.jsx($,{label:"Sector",value:i.company.sector||"â€”"}),e.jsx($,{label:"Industry",value:i.company.industry||"â€”"}),e.jsx($,{label:"Market Cap",value:b(i.company.marketCap)}),e.jsx($,{label:"Avg Volume",value:a(i.company.avgVolume)}),e.jsx($,{label:"Float",value:i.company.floatShares?a(i.company.floatShares):"â€”"}),e.jsx($,{label:"Short %",value:i.company.shortPercentOfFloat?`${i.company.shortPercentOfFloat}%`:"â€”"}),e.jsx($,{label:"Beta",value:((P=i.company.beta)==null?void 0:P.toFixed(2))||"â€”"})]})]}),((C=i.technicals)==null?void 0:C.available)&&e.jsxs("div",{className:"aiq-dd-section",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"Technicals"}),e.jsxs("div",{className:"aiq-dd-grid",children:[e.jsx($,{label:"Trend",value:i.technicals.trend,valueColor:i.technicals.trend==="bullish"?"var(--accent-green)":i.technicals.trend==="bearish"?"var(--accent-red)":void 0}),e.jsx($,{label:"RSI(14)",value:((f=i.technicals.rsi)==null?void 0:f.toFixed(1))||"â€”"}),e.jsx($,{label:"ATR(14)",value:i.technicals.atr?`$${i.technicals.atr.toFixed(2)} (${i.technicals.atrPercent}%)`:"â€”"}),e.jsx($,{label:"vs 20-SMA",value:i.technicals.distSMA20!=null?`${i.technicals.distSMA20>0?"+":""}${i.technicals.distSMA20}%`:"â€”"}),e.jsx($,{label:"vs 50-SMA",value:i.technicals.distSMA50!=null?`${i.technicals.distSMA50>0?"+":""}${i.technicals.distSMA50}%`:"â€”"}),e.jsx($,{label:"52W Range",value:i.technicals.low52w&&i.technicals.high52w?`$${i.technicals.low52w} â€“ $${i.technicals.high52w}`:"â€”"})]})]}),((A=i.expectedMove)==null?void 0:A.available)&&e.jsxs("div",{className:"aiq-dd-section",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"Expected Move"}),e.jsxs("div",{className:"aiq-dd-grid",children:[e.jsx($,{label:"Straddle",value:`$${i.expectedMove.straddle}`}),e.jsx($,{label:"Exp Move",value:`Â±$${i.expectedMove.expectedMove} (${i.expectedMove.expectedMovePercent}%)`}),e.jsx($,{label:"IV",value:i.expectedMove.ivPercent?`${i.expectedMove.ivPercent}%`:"â€”"}),e.jsx($,{label:"Range",value:`$${i.expectedMove.rangeLow} â€“ $${i.expectedMove.rangeHigh}`})]})]}),i.earnings&&e.jsxs("div",{className:"aiq-dd-section",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"Earnings"}),e.jsxs("div",{className:"aiq-dd-grid",children:[e.jsx($,{label:"Next Date",value:i.earnings.earningsDate||"â€”"}),e.jsx($,{label:"EPS Est",value:i.earnings.epsEstimate!=null?`$${i.earnings.epsEstimate.toFixed(2)}`:"â€”"}),e.jsx($,{label:"Beats",value:i.earnings.beatsInLast4!=null?`${i.earnings.beatsInLast4}/4`:"â€”"}),e.jsx($,{label:"Rev Growth",value:i.earnings.revenueGrowth!=null?`${i.earnings.revenueGrowth}%`:"â€”"})]})]}),i.sentiment&&e.jsxs("div",{className:"aiq-dd-section",children:[e.jsx("div",{className:"aiq-dd-section__title",children:"Sentiment"}),e.jsxs("div",{className:"aiq-dd-grid",children:[e.jsx($,{label:"Rating",value:i.sentiment.recommendationKey||"â€”"}),e.jsx($,{label:"# Analysts",value:i.sentiment.numberOfAnalysts??"â€”"}),e.jsx($,{label:"Target",value:i.sentiment.targetMeanPrice?S(i.sentiment.targetMeanPrice):"â€”"}),e.jsx($,{label:"Upside",value:i.sentiment.targetVsPrice!=null?`${i.sentiment.targetVsPrice>0?"+":""}${i.sentiment.targetVsPrice}%`:"â€”",valueColor:i.sentiment.targetVsPrice>0?"var(--accent-green)":i.sentiment.targetVsPrice<0?"var(--accent-red)":void 0})]})]}),e.jsx("div",{className:"aiq-dd-actions",children:e.jsxs("button",{className:"aiq-btn aiq-btn--primary",onClick:()=>n==null?void 0:n({ticker:s,strategy:c,data:i}),children:[e.jsx(Ne,{size:14})," Build Trade Plan"]})})]})]})}function $({label:s,value:l,valueColor:n}){return e.jsxs("div",{className:"aiq-stat-row",children:[e.jsx("span",{className:"aiq-stat-row__label",children:s}),e.jsx("span",{className:"aiq-stat-row__value",style:n?{color:n}:void 0,children:l})]})}function es({plan:s,onClose:l}){var u,i;const[n,c]=m.useState(!1);if(!s)return null;const t=s.direction==="long",o=()=>{var h,r;const d=[`Trade Plan: ${s.ticker} (${(h=s.strategy)==null?void 0:h.toUpperCase()})`,`Direction: ${(r=s.direction)==null?void 0:r.toUpperCase()}`,`Entry: $${s.entry}`,`Stop: $${s.stop} (risk: $${s.riskPerShare}/share)`,...s.targets.map(p=>`Target ${p.label}: $${p.price} (${p.rr})`),`ATR: $${s.atr} (${s.atrPercent}%)`,s.expectedMove?`Expected Move: $${s.expectedMove}`:"","",...s.notes].filter(Boolean).join(`
`);navigator.clipboard.writeText(d).then(()=>{c(!0),setTimeout(()=>c(!1),2e3)})};return e.jsx("div",{className:"aiq-modal-overlay",onClick:l,children:e.jsxs("div",{className:"aiq-modal",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"aiq-modal__header",children:[e.jsxs("h3",{children:[e.jsx(ke,{size:18}),"Trade Plan: ",s.ticker]}),e.jsxs("div",{className:"aiq-modal__header-actions",children:[e.jsx("button",{className:"aiq-icon-btn",onClick:o,title:"Copy to clipboard",children:n?e.jsx(Se,{size:16,color:"var(--accent-green)"}):e.jsx(Ce,{size:16})}),e.jsx("button",{className:"aiq-icon-btn",onClick:l,children:e.jsx(X,{size:16})})]})]}),e.jsxs("div",{className:"aiq-modal__body",children:[e.jsxs("div",{className:`aiq-plan-direction ${t?"aiq-plan-direction--long":"aiq-plan-direction--short"}`,children:[t?e.jsx($e,{size:16}):e.jsx(_e,{size:16}),e.jsx("span",{children:t?"LONG":"SHORT"}),e.jsx("span",{className:"aiq-plan-strategy",children:(u=s.strategy)==null?void 0:u.toUpperCase()})]}),e.jsxs("div",{className:"aiq-plan-grid",children:[e.jsxs("div",{className:"aiq-plan-cell",children:[e.jsx("div",{className:"aiq-plan-cell__label",children:"Entry"}),e.jsxs("div",{className:"aiq-plan-cell__value",children:["$",s.entry]})]}),e.jsxs("div",{className:"aiq-plan-cell aiq-plan-cell--stop",children:[e.jsx("div",{className:"aiq-plan-cell__label",children:"Stop Loss"}),e.jsxs("div",{className:"aiq-plan-cell__value",children:["$",s.stop]}),e.jsxs("div",{className:"aiq-plan-cell__sub",children:["-$",s.riskPerShare,"/share"]})]}),e.jsxs("div",{className:"aiq-plan-cell",children:[e.jsx("div",{className:"aiq-plan-cell__label",children:"ATR"}),e.jsxs("div",{className:"aiq-plan-cell__value",children:["$",s.atr]}),e.jsxs("div",{className:"aiq-plan-cell__sub",children:[s.atrPercent,"%"]})]})]}),e.jsxs("div",{className:"aiq-plan-targets",children:[e.jsx("div",{className:"aiq-plan-targets__title",children:"Targets"}),s.targets.map(d=>e.jsxs("div",{className:"aiq-plan-target",children:[e.jsx("span",{className:"aiq-plan-target__label",children:d.label}),e.jsxs("span",{className:"aiq-plan-target__price",children:["$",d.price]}),e.jsx("span",{className:"aiq-plan-target__rr",children:d.rr}),e.jsx("div",{className:"aiq-plan-target__bar",children:e.jsx("div",{className:"aiq-plan-target__fill",style:{width:`${Math.min(100,parseInt(d.label)*33)}%`}})})]},d.label))]}),e.jsx(ss,{riskPerShare:s.riskPerShare,entry:s.entry}),((i=s.notes)==null?void 0:i.length)>0&&e.jsxs("div",{className:"aiq-plan-notes",children:[e.jsx("div",{className:"aiq-plan-notes__title",children:"Strategy Notes"}),e.jsx("ul",{children:s.notes.map((d,h)=>e.jsx("li",{children:d},h))})]})]})]})})}function ss({riskPerShare:s,entry:l}){const[n,c]=m.useState(""),t=parseFloat(n)||0,o=s>0?Math.floor(t/s):0,u=o*(l||0);return e.jsxs("div",{className:"aiq-position-sizer",children:[e.jsx("div",{className:"aiq-position-sizer__title",children:"Position Sizer"}),e.jsxs("div",{className:"aiq-position-sizer__row",children:[e.jsx("label",{children:"Risk $ per trade:"}),e.jsx("input",{type:"number",value:n,onChange:i=>c(i.target.value),placeholder:"e.g. 200",className:"aiq-input"})]}),o>0&&e.jsxs("div",{className:"aiq-position-sizer__result",children:[e.jsxs("span",{children:[o," shares"]}),e.jsxs("span",{children:["â‰ˆ $",u.toLocaleString()," position"]})]})]})}function as({ticker:s,onClose:l}){const[n,c]=m.useState(""),[t,o]=m.useState("long"),[u,i]=m.useState(null),[d,h]=m.useState(!1),r=async()=>{if(!n.trim()||d)return;h(!0),i(null);const p=[`I want to go ${t.toUpperCase()} on ${s}.`,`My thesis: ${n}`,"","Challenge this thesis. Be the devil's advocate.","List 3-5 specific counter-arguments with data points.","End with a risk rating (Low / Medium / High) for this trade.","Keep it concise and actionable."].join(`
`);try{const x=await fetch("/api/ai-quant/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:p,contextSource:"scanner"})}),j=await x.json();if(!x.ok)throw new Error(j.error||`HTTP ${x.status}`);i(j.answer)}catch(x){i(`Error: ${x.message}`)}finally{h(!1)}};return e.jsx("div",{className:"aiq-modal-overlay",onClick:l,children:e.jsxs("div",{className:"aiq-modal aiq-modal--challenge",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"aiq-modal__header",children:[e.jsxs("h3",{children:[e.jsx(Z,{size:18})," Bias Challenge: ",s]}),e.jsx("button",{className:"aiq-icon-btn",onClick:l,children:e.jsx(X,{size:16})})]}),e.jsxs("div",{className:"aiq-modal__body",children:[e.jsxs("div",{className:"aiq-challenge-form",children:[e.jsxs("div",{className:"aiq-challenge-direction",children:[e.jsx("button",{className:`aiq-dir-btn ${t==="long"?"aiq-dir-btn--active-long":""}`,onClick:()=>o("long"),children:"Long â†‘"}),e.jsx("button",{className:`aiq-dir-btn ${t==="short"?"aiq-dir-btn--active-short":""}`,onClick:()=>o("short"),children:"Short â†“"})]}),e.jsx("textarea",{className:"aiq-challenge-textarea",value:n,onChange:p=>c(p.target.value),placeholder:`Why do you want to go ${t} on ${s}? Enter your thesisâ€¦`,rows:3}),e.jsx("button",{className:"aiq-btn aiq-btn--warning",onClick:r,disabled:d||!n.trim(),children:d?e.jsxs(e.Fragment,{children:[e.jsx(de,{size:14,className:"aiq-spin"})," Analyzingâ€¦"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:14})," Challenge My Thesis"]})})]}),u&&e.jsxs("div",{className:"aiq-challenge-response",children:[e.jsx("div",{className:"aiq-challenge-response__icon",children:e.jsx(J,{size:16})}),e.jsx("div",{className:"aiq-challenge-response__text",children:u})]})]})]})})}function ts(){const[s,l]=m.useState([]),[n,c]=m.useState(""),[t,o]=m.useState(!1),[u,i]=m.useState(!1),d=m.useRef(null),h=m.useRef(null);m.useEffect(()=>{var x;(x=d.current)==null||x.scrollIntoView({behavior:"smooth"})},[s]);const r=async()=>{const x=n.trim();if(!x||t)return;const j={role:"user",content:x,ts:Date.now()};l(k=>[...k,j]),c(""),o(!0);try{const k=await fetch("/api/ai-quant/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:x,contextSource:"scanner"})}),M=await k.json();if(!k.ok)throw new Error(M.error||`HTTP ${k.status}`);l(g=>[...g,{role:"assistant",content:M.answer,ts:Date.now()}])}catch(k){l(M=>[...M,{role:"assistant",content:`Error: ${k.message}`,ts:Date.now(),error:!0}])}finally{o(!1)}},p=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),r())};return e.jsxs("div",{className:`aiq-chat ${u?"aiq-chat--expanded":""}`,children:[e.jsxs("div",{className:"aiq-chat__header",onClick:()=>i(!u),children:[e.jsx(ye,{size:15}),e.jsx("span",{children:"AI Chat"}),e.jsx("span",{className:"aiq-chat__toggle",children:u?"â–¼":"â–²"})]}),u&&e.jsxs("div",{className:"aiq-chat__body",children:[e.jsxs("div",{className:"aiq-chat__messages",children:[s.length===0&&e.jsx("div",{className:"aiq-chat__empty",children:"Ask about tickers, setups, or market conditions. The AI has access to live scanner context."}),s.map((x,j)=>e.jsxs("div",{className:`aiq-chat__msg aiq-chat__msg--${x.role} ${x.error?"aiq-chat__msg--error":""}`,children:[e.jsx("div",{className:"aiq-chat__msg-icon",children:x.role==="user"?e.jsx(Ve,{size:14}):e.jsx(J,{size:14})}),e.jsx("div",{className:"aiq-chat__msg-text",children:x.content})]},j)),t&&e.jsxs("div",{className:"aiq-chat__msg aiq-chat__msg--assistant",children:[e.jsx("div",{className:"aiq-chat__msg-icon",children:e.jsx(J,{size:14})}),e.jsxs("div",{className:"aiq-chat__msg-text aiq-chat__typing",children:[e.jsx(de,{size:14,className:"aiq-spin"})," Thinkingâ€¦"]})]}),e.jsx("div",{ref:d})]}),e.jsxs("div",{className:"aiq-chat__input-row",children:[e.jsx("input",{ref:h,type:"text",value:n,onChange:x=>c(x.target.value),onKeyDown:p,placeholder:"Ask about a ticker, setup, or market conditionsâ€¦",className:"aiq-chat__input",disabled:t}),e.jsx("button",{className:"aiq-chat__send",onClick:r,disabled:t||!n.trim(),children:e.jsx(Fe,{size:16})})]})]})]})}const ns=[{key:"priceMin",label:"Price Min",placeholder:"5",type:"number",step:"1"},{key:"priceMax",label:"Price Max",placeholder:"500",type:"number",step:"1"},{key:"gapMin",label:"Gap% Min",placeholder:"2",type:"number",step:"0.5"},{key:"rvolMin",label:"RVOL Min",placeholder:"1.5",type:"number",step:"0.1"},{key:"avgVolMin",label:"Avg Vol Min",placeholder:"500000",type:"number",step:"100000"},{key:"emMin",label:"Exp Move% Min",placeholder:"3",type:"number",step:"1"},{key:"minConfirmations",label:"Min Confirmations",placeholder:"1",type:"number",step:"1"}];function is({filters:s,setFilters:l,validationMode:n,setValidationMode:c,collapsed:t,setCollapsed:o}){const u=(h,r)=>{const p=r===""?void 0:Number(r);l(x=>({...x,[h]:p}))},i=Object.values(s).filter(h=>h!=null).length+(n?1:0),d=()=>{l({}),c(!1)};return e.jsxs("div",{className:"aiq-filters-panel",children:[e.jsxs("div",{className:"aiq-filters-header",onClick:()=>o(!t),children:[e.jsxs("span",{className:"aiq-filters-title",children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M22 3H2l8 9.46V19l4 2v-8.54L22 3z"})}),"Filters ",i>0&&e.jsx("span",{className:"aiq-filters-count",children:i})]}),e.jsxs("span",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i>0&&e.jsx("button",{className:"aiq-filters-clear",onClick:h=>{h.stopPropagation(),d()},children:"Clear"}),e.jsx("span",{className:"aiq-filters-chevron",children:t?"â–¸":"â–¾"})]})]}),!t&&e.jsxs("div",{className:"aiq-filters-body",children:[e.jsx("div",{className:"aiq-filters-grid",children:ns.map(h=>e.jsxs("label",{className:"aiq-filter-field",children:[e.jsx("span",{children:h.label}),e.jsx("input",{type:h.type,step:h.step,placeholder:h.placeholder,value:s[h.key]??"",onChange:r=>u(h.key,r.target.value)})]},h.key))}),e.jsxs("label",{className:"aiq-validation-toggle",children:[e.jsx("input",{type:"checkbox",checked:n,onChange:h=>c(h.target.checked)}),e.jsxs("span",{className:"aiq-validation-label",children:[e.jsx("strong",{children:"Validation Mode"}),e.jsx("small",{children:"â‰¥2 confirmations Â· Avg Vol â‰¥500K Â· Complete data only"})]})]})]})]})}let ls=0;function rs(){const[s,l]=m.useState([]),n=m.useCallback((c,t="info",o=3e3)=>{const u=++ls;l(i=>[...i,{id:u,message:c,type:t}]),setTimeout(()=>l(i=>i.filter(d=>d.id!==u)),o)},[]);return{toasts:s,addToast:n}}function cs({toasts:s}){return s!=null&&s.length?e.jsx("div",{className:"aiq-toast-container",children:s.map(l=>e.jsxs("div",{className:`aiq-toast aiq-toast-${l.type}`,children:[l.type==="success"&&"âœ“ ",l.type==="error"&&"âœ— ",l.message]},l.id))}):null}function ds(){const[s,l]=m.useState("orb"),[n,c]=m.useState(null),[t,o]=m.useState(null),[u,i]=m.useState(!1),[d,h]=m.useState(!1),[r,p]=m.useState({}),[x,j]=m.useState(!1),[k,M]=m.useState(!0),[g,y]=m.useState(new Set),S=m.useRef({orb:[],earnings:[],continuation:[]}),[b,a]=m.useState({orb:[],earnings:[],continuation:[]}),{toasts:v,addToast:P}=rs(),C=Me(),f={...r,validationMode:x},A=m.useCallback((F,H)=>{S.current={...S.current,[F]:H};const N={};for(const[_,B]of Object.entries(S.current))for(const z of B)N[z.ticker]||(N[z.ticker]=new Set),N[z.ticker].add(_);const E={};for(const[_,B]of Object.entries(S.current))E[_]=B.map(z=>{const Q=N[z.ticker]?[...N[z.ticker]].filter(w=>w!==_):[],he={orb:"ORB",earnings:"EARN",continuation:"CONT"},te=Q.map(w=>he[w]).filter(Boolean),ne=te.length;return{...z,confirmations:ne,confirmBadges:te,confidenceTier:De(z.score,ne)}});a(E)},[]),q=m.useCallback((F,H)=>{y(N=>{const E=new Set(N);return H===!0?E.add(F):H===!1||E.has(F)?E.delete(F):E.add(F),E})},[]),I=m.useCallback(F=>c(F),[]),W=m.useCallback(()=>c(null),[]),T=m.useCallback(async({ticker:F,strategy:H,data:N})=>{var E,_;i(!0);try{const B={ticker:F,strategy:H||s,direction:"long",entryPrice:(N==null?void 0:N.price)||null,atr:((E=N==null?void 0:N.technicals)==null?void 0:E.atr)||null,expectedMove:((_=N==null?void 0:N.expectedMove)==null?void 0:_.expectedMove)||null},z=await fetch("/api/ai-quant/build-plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)}),Q=await z.json();if(!z.ok)throw new Error(Q.error||"Failed to build plan");o(Q)}catch(B){console.error("Build plan error:",B)}finally{i(!1)}},[s]),O=n?Object.values(b).flat().find(F=>F.ticker===n):null;return e.jsxs("div",{className:`aiq-page ${n?"aiq-page--has-dive":""}`,children:[e.jsx(Be,{}),e.jsxs("div",{className:"aiq-center-col",children:[e.jsx(is,{filters:r,setFilters:p,validationMode:x,setValidationMode:j,collapsed:k,setCollapsed:M}),e.jsx(Ze,{activeStrategy:s,onChangeStrategy:l,onSelectTicker:I,filters:f,selected:g,onToggleSelect:q,onDataReady:A,allData:b,addToast:P,watchlist:C})]}),n&&e.jsx(Xe,{ticker:n,onClose:W,onBuildPlan:T,activeStrategy:s,rowData:O,watchlist:C,addToast:P}),n&&!d&&e.jsxs("button",{className:"aiq-bias-trigger",onClick:()=>h(!0),title:"Challenge your bias",children:[e.jsx(Z,{size:16})," Challenge Bias"]}),e.jsx(ts,{}),e.jsx(cs,{toasts:v}),t&&e.jsx(es,{plan:t,onClose:()=>o(null)}),d&&n&&e.jsx(as,{ticker:n,onClose:()=>h(!1)})]})}export{ds as default};
